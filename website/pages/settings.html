<style>
    #yourAddress{
        display: inline-block;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: right;
        font-family: 'Inconsolata', monospace;
        font-size: 0.9em;
    }
    #yourEmail{
        max-width: 25%;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: right;
        font-family: 'Inconsolata', monospace;
        font-size: 0.9em;
    }
    #yourIP{
        max-width: 25%;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: right;
        font-family: 'Inconsolata', monospace;
        font-size: 0.9em;
    }
</style>
<script>

		function isEmail(email) {
			var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			return regex.test(email);
		}

    function editEmailAddress(email, address, ip, action) {
				if (address.length != 99) {
            $('#action_update_message').text('Please double check your Sumo address');
            $('#action_update_message').removeClass().addClass('alert alert-warning');
            return;
        }

				if (!isEmail(email)) {
            $('#action_update_message').text('That doesn\'t look like an email buddy.');
            $('#action_update_message').removeClass().addClass('alert alert-danger');
            return;
        }

        $.ajax({
            url: api + '/set_notification?address=' + address + '&ip=' + ip + '&email=' + email + '&action=' + action,
            dataType: 'json',
            cache: 'false'
        }).done(function(data){
            if (data.status == "done") {
								$('#action_update_message').text('Email entry was ' + (action == 'delete' ? 'removed' : 'added'));
                $('#action_update_message').removeClass().addClass('alert alert-success');
						} else {
								$('#action_update_message').text('OOPS! Something went wrong: ' + data.status);
                $('#action_update_message').removeClass().addClass('alert alert-danger');
            }
        });
    }

    function getEmailAddress(address) {
        $.ajax({
            url: api + '/get_notification?address=' + address,
            dataType: 'json',
            cache: 'false'
        }).done(function(data){
          if (data.email != undefined) {
            $('#yourEmail').val(data.email);
            $('#action_update_message').text('Good! You already enabled notifications.');
          }
        });
    }

    $('#enableButton').click(function(){
        var email = $('#yourEmail').val();
        var address = $('#yourAddress').val();
        var ip = $('#yourIP').val();
				editEmailAddress(email, address, ip, 'upsert');
    });

    $('#disableButton').click(function(){
        var email = $('#yourEmail').val();
        var address = $('#yourAddress').val();
        var ip = $('#yourIP').val();
				editEmailAddress(email, address, ip, 'delete');
    });


</script>

<div class="stats">
    <h3>Enable email notifications</h3>
    This pool will send out notification whenever a payout happens. To
    receive notications; enter your wallet address (the one used by your
    miners) and your email below.

    In order to get a little more confidence that the wallet address is yours;
    we ask you to give one of the IP addresses that is used by your miner. If
    you mine from your home network then you can find the IP <a
     href="https://www.google.ch/search?q=whats+my+ip" target="_blank">here</a>.
    <div>
      <div id="action_update_message" role="alert" ></div>
    </div>
    <div class="form-group">
        <label for="yourAddress">Sumo address:</label>
        <input class="form-control" id="yourAddress" type="text" placeholder="Enter Your Address">
    </div>
    <div class="form-group">
        <label for="yourAddress">Email address:</label>
        <input class="form-control" id="yourEmail" type="text" placeholder="Enter Your email">
    </div>
    <div class="form-group">
        <label for="yourAddress">Miner IP address:</label>
        <input class="form-control" id="yourIP" type="text" placeholder="An IP address your miners use (any)">
    </div>
    <div class="form-group">
        <span class="input-group-btn">
            <button class="btn btn-default" type="button" id="enableButton">
                <span><i class="fa fa-check"></i> Enable</span>
            </button>
            <button class="btn btn-default" type="button" id="disableButton">
                <span><i class="fa fa-ban"></i> Disable</span>
            </button>
        </span>
    </div>
</div>

<script>
    currentPage = {
        destroy: function(){
        },
        update: function(){
        }
    };


    var urlWalletAddress = location.search.split('wallet=')[1] || 0;
    var address = urlWalletAddress || docCookies.getItem('mining_address');

    if (address){
        $('#yourAddress').val(address);
        getEmailAddress(address);
    }

</script>
