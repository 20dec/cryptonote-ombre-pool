<style>
    #yourAddress{
        display: inline-block;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: right;
        font-family: 'Inconsolata', monospace;
        font-size: 0.9em;
    }
    #yourEmail{
        max-width: 25%;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: right;
        font-family: 'Inconsolata', monospace;
        font-size: 0.9em;
    }
    #addressError{
        color: red;
    }

</style>
<script>

		function isEmail(email) {
			var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			return regex.test(email);
		}

    function editEmailAddress(email, address, action) {
				if (address.length != 99) {
            $('#action_update_message').text('Please double check your Sumo address');
            return;
        }

				if (!isEmail(email)) {
            $('#action_update_message').text('That doesn\'t look like an email buddy.');
            return;
        }

        $.ajax({
            url: api + '/set_notification?address=' + address + '&email=' + email + '&action=' + action,
            dataType: 'json',
            cache: 'false'
        }).done(function(data){
            if (data.status == "done") {
								$('#action_update_message').text('Email entry was ' + (action == 'delete' ? 'removed' : 'added'));
						} else {
								$('#action_update_message').text('Something went wrong: ' + data.status);
            }
        });
    }

    function setEmailAddress(address) {
        $.ajax({
            url: api + '/get_notification?address=' + address,
            dataType: 'json',
            cache: 'false'
        }).done(function(data){
          if (data.email != undefined) {
            $('#yourEmail').val(data.email);
            $('#action_update_message').text('Good! You already enabled notifications.');
          }
        });
    }


    $('#enableButton').click(function(){
        var email = $('#yourEmail').val();
        var address = $('#yourAddress').val();
				editEmailAddress(email, address, 'upsert');
    });

    $('#disableButton').click(function(){
        var email = $('#yourEmail').val();
        var address = $('#yourAddress').val();
				editEmailAddress(email, address, 'delete');
    });


</script>

<div class="stats">
    <h3>Enable email notifications</h3>
    This pool will send out notification whenever a payout happens. To
    receive notications; enter your wallet address (the one used by your
    miners) and your email below.
    <div>
      <span id="action_update_message"></span>
    </div>
    <div class="form-group">
        <label for="yourAddress">Sumo address:</label>
        <input class="form-control" id="yourAddress" type="text" placeholder="Enter Your Address">
    </div>
    <div class="form-group">
        <label for="yourAddress">Email address:</label>
        <input class="form-control" id="yourEmail" type="text" placeholder="Enter Your email">
    </div>
    <div class="form-group">
        <span class="input-group-btn">
            <button class="btn btn-default" type="button" id="enableButton">
                <span><i class="fa fa-check"></i> Enable</span>
            </button>
            <button class="btn btn-default" type="button" id="disableButton">
                <span><i class="fa fa-ban"></i> Disable</span>
            </button>
        </span>
    </div>
</div>

<script>


    currentPage = {
        destroy: function(){
        },
        update: function(){
        }
    };


    var urlWalletAddress = location.search.split('wallet=')[1] || 0;
    var address = urlWalletAddress || docCookies.getItem('mining_address');

    if (address){
        $('#yourAddress').val(address);
        setEmailAddress(address);
    }

</script>
